<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.autotradebot.mapper.binance.BinanceKlineMapper">

    <!-- ✅ Kline 데이터 저장 (선물 데이터 반영) -->
    <insert id="insertKline" parameterType="com.example.autotradebot.dto.binance.BinanceKlineDTO">
        INSERT INTO binance_kline (symbol, open_time, close_time, open_price, close_price, high_price, low_price,
                                   volume, trade_count)
        VALUES (#{symbol}, #{openTime}, #{closeTime}, #{openPrice}, #{closePrice}, #{highPrice}, #{lowPrice}, #{volume},
                #{tradeCount}) ON DUPLICATE KEY
        UPDATE
            close_time =
        VALUES (close_time), open_price =
        VALUES (open_price), close_price =
        VALUES (close_price), high_price =
        VALUES (high_price), low_price =
        VALUES (low_price), volume =
        VALUES (volume), trade_count =
        VALUES (trade_count)
    </insert>

    <!-- ✅ 특정 심볼 & 특정 시간 범위 Kline 조회 -->
    <select id="getKlinesWithinTimeRange" resultType="com.example.autotradebot.dto.binance.BinanceKlineDTO">
        SELECT *
        FROM binance_kline
        WHERE symbol = #{symbol}
          AND open_time BETWEEN #{openTime} AND #{closeTime}
        ORDER BY open_time DESC
    </select>

    <!-- ✅ 최신 Kline 데이터 가져오기 -->
    <select id="getLatestKline" resultType="com.example.autotradebot.dto.binance.BinanceKlineDTO">
        SELECT *
        FROM binance_kline
        WHERE symbol = #{symbol}
        ORDER BY open_time DESC LIMIT 1
    </select>

</mapper>
