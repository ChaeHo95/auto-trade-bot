<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.autotradebot.mapper.analysis.PredictionMapper">

    <!-- ✅ 최신 AI 분석 결과 가져오기 -->
    <select id="getLatestPrediction" resultType="com.example.autotradebot.dto.analysis.PredictionDTO">
        SELECT id,
               bot_type,
               symbol,
               analysis_time,
               recommended_position,
               confidence_score,
               moving_average,
               rsi_value,
               macd_value,
               volatility,
               funding_rate,
               trade_volume
        FROM chart_analysis_predictions
        WHERE symbol = #{symbol}
        ORDER BY analysis_time DESC LIMIT 1;
    </select>

    <!-- ✅ AI 분석 결과 저장 -->
    <insert id="savePrediction">
        INSERT INTO chart_analysis_predictions
        (bot_type, symbol, analysis_time, recommended_position, confidence_score, moving_average, rsi_value,
         macd_value, volatility, funding_rate, trade_volume, reason)
        VALUES (#{botType}, #{symbol}, #{analysisTime}, #{recommendedPosition}, #{confidenceScore}, #{movingAverage},
                #{rsiValue}, #{macdValue}, #{volatility}, #{fundingRate}, #{tradeVolume}, #{reason});
    </insert>

</mapper>
