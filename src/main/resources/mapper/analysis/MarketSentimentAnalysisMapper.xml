<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.autotradebot.mapper.analysis.MarketSentimentAnalysisMapper">

    <!-- ✅ 최신 시장 감성 분석 결과 가져오기 -->
    <select id="getLatestSentimentAnalysis"
            resultType="com.example.autotradebot.dto.analysis.MarketSentimentAnalysisDTO">
        SELECT id,
               symbol,
               analysis_time,
               sentiment_score,
               positive_news_count,
               negative_news_count,
               neutral_news_count,
               tweet_volume,
               economic_event,
               created_at
        FROM market_sentiment_analysis
        WHERE symbol = #{symbol}
        ORDER BY analysis_time DESC LIMIT 1;
    </select>

    <!-- ✅ 시장 감성 분석 결과 저장 -->
    <insert id="saveSentimentAnalysis">
        INSERT INTO market_sentiment_analysis
        (symbol, analysis_time, sentiment_score, positive_news_count, negative_news_count,
         neutral_news_count, tweet_volume, economic_event, created_at)
        VALUES (#{symbol}, #{analysisTime}, #{sentimentScore}, #{positiveNewsCount}, #{negativeNewsCount},
                #{neutralNewsCount}, #{tweetVolume}, #{economicEvent}, NOW());
    </insert>

</mapper>
