<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.autotradebot.mapper.analysis.AiAnalysisFinalHistoryMapper">

    <!-- ✅ AI 분석 결과 저장 -->
    <insert id="insertAiAnalysisFinalHistory">
        INSERT INTO ai_analysis_final_history (symbol, analysis_time, chart_analysis_id, recommended_position,
                                               executed_position, profit_loss, confidence_score)
        VALUES (#{symbol}, #{analysisTime}, #{chartAnalysisId}, #{recommendedPosition},
                #{executedPosition}, #{profitLoss}, #{confidenceScore});
    </insert>

    <!-- ✅ 특정 심볼의 최신 AI 분석 결과 조회 -->
    <select id="getLatestAiAnalysisFinalHistory"
            resultType="com.example.autotradebot.dto.analysis.AiAnalysisFinalHistoryDTO">
        SELECT *
        FROM ai_analysis_final_history
        WHERE symbol = #{symbol}
        ORDER BY analysis_time DESC LIMIT 1;
    </select>

    <!-- ✅ 특정 심볼의 전체 AI 분석 결과 조회 -->
    <select id="getAllAiAnalysisFinalHistory"
            resultType="com.example.autotradebot.dto.analysis.AiAnalysisFinalHistoryDTO">
        SELECT *
        FROM ai_analysis_final_history
        WHERE symbol = #{symbol}
        ORDER BY analysis_time DESC;
    </select>

    <!-- ✅ 특정 심볼의 AI 분석 데이터 삭제 -->
    <delete id="deleteAiAnalysisFinalHistory">
        DELETE
        FROM ai_analysis_final_history
        WHERE symbol = #{symbol};
    </delete>

</mapper>
